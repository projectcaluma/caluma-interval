version: "3.4"

services:
  interval:
    image: projectcaluma/caluma-interval:latest@sha256:aa1df6ac8732549a078bc8fa0433e6ec8f40e455af1d328158ac5a32beed9372
    build:
      context: .
    depends_on:
      - caluma

  db:
    image: postgres:9.6-alpine@sha256:a97ee77d345908ebb6e92298e4753833daae2b606339d7c03e91c369b9409078
    environment:
      - POSTGRES_USER=caluma
    volumes:
      - dbdata:/var/lib/postgresql/data
    command: -p ${DATABASE_PORT:-5432}

  caluma:
    image: projectcaluma/caluma:latest@sha256:325f354cd34ac7decb3fb3678658fa21e9af2fce065c5f919b04f6b9c6ef3409
    ports:
      - "8000:8000"
    depends_on:
      - db

    environment:
      - DATABASE_HOST=db
      - SECRET_KEY=uuuuuu
      - ALLOWED_HOSTS=*
      - DATABASE_PASSWORD=caluma
      - VISIBILITY_CLASSES=caluma.core.visibilities.Any
      - PERMISSION_CLASSES=caluma.core.permissions.AllowAny

volumes:
  dbdata:
